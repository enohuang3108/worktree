# 需求文件

## 專案概覽
將現有的 TypeScript Git worktree CLI 工具完全遷移至 Rust，提供獨立可執行檔供使用者直接使用，無需安裝 Rust 工具鏈。

## 專案描述（使用者輸入）
migration 專案用rust改寫，保持現有功能，最後讓可用者可以直接使用可執行檔，不需要rust、cargo 之類的。

## 功能需求

### 主要 CLI 命令

#### 1. `wt add` - 創建 worktree
- **提示**: 提示目前的專案名稱
- **輸入選項**: 新分支模式 / 現有分支模式
- **新分支模式**: 輸入分支名稱，選擇基礎分支
- **現有分支模式**: 從現有分支列表中選擇
- **路徑生成**: 自動生成 `../<專案名>-worktree/<專案名>-<分支名>-worktree`
- **Git 整合**: 執行 `git worktree add` 命令
- **VSCode 整合**: 可選在 VSCode 中開啟新 worktree

#### 2. `wt remove/rm/delete` - 移除 worktree
- **提示**: 提示目前的專案名稱
- **列表顯示**: 顯示所有現有 worktree
- **交互選擇**: 使用者選擇要移除的 worktree
- **安全確認**: 刪除前需要確認
- **Git 整合**: 執行 `git worktree remove` 命令

#### 3. `wt open` - 開啟 worktree
- **提示**: 提示目前的專案名稱
- **列表顯示**: 顯示所有可用 worktree
- **VSCode 整合**: 在 VSCode 中開啟選擇的 worktree

### 核心功能模組

#### Git 操作
- **倉庫檢測**: 驗證當前目錄是否為 Git 倉庫
- **專案名稱**: 從 Git remote URL 或目錄名獲取專案名稱
- **分支管理**: 獲取本地和遠程分支列表
- **Worktree 管理**: 創建、列出、移除 worktree

#### 使用者介面
- **交互式選單**: 提供選擇列表、文字輸入、確認對話框
- **彩色輸出**: 成功（綠色）、錯誤（紅色）、資訊（藍色）
- **錯誤處理**: 使用者友善的錯誤訊息

#### 檔案系統操作
- **目錄管理**: 創建必要的父目錄
- **路徑生成**: 標準化的 worktree 路徑結構
- **權限檢查**: 確保檔案系統操作權限

## 技術需求

### 核心技術棧
- **語言**: Rust（替代 TypeScript）
- **CLI 框架**: clap（替代 commander.js）
- **交互介面**: dialoguer 或 inquire（替代 inquirer.js）
- **彩色輸出**: colored 或 termcolor（替代 chalk）
- **進程執行**: std::process（替代 execa）

### 建置和分發
- **編譯目標**: 靜態連結的單一二進制檔案
- **跨平台支援**: Linux (x64/arm64), macOS (x64/arm64), Windows (x64)
- **分發機制**: GitHub Releases 自動化發布
- **安裝方法**:
  - 自動安裝腳本（Linux/macOS）
  - 手動下載預編譯二進制檔案
  - 包管理器支援（未來考慮）

### 效能需求
- **啟動時間**: < 100ms（相比 Node.js 版本的改善）
- **記憶體使用**: < 10MB 運行時記憶體
- **二進制大小**: < 5MB 靜態編譯後大小

### 相容性需求
- **CLI 介面**: 100% 保持與 TypeScript 版本相同的命令和選項
- **路徑結構**: 維持相同的 worktree 目錄命名規則
- **Git 整合**: 使用相同的 Git 命令和參數
- **VSCode 整合**: 保持 `code` 命令調用機制

## 使用者故事

### 故事 1: 開發者創建新功能分支 worktree
**身份**: 軟體開發者
**需求**: 我想為新功能創建一個乾淨的工作環境，而不影響當前的開發工作
**行為**:
1. 執行 `wt add`
2. 選擇 "新分支" 選項
3. 輸入分支名稱 "feature-login"
4. 選擇基礎分支 "main"
5. 確認在 VSCode 中開啟
**結果**: 系統創建 `../project-worktree/project-feature-login-worktree` 目錄，建立新分支，並在 VSCode 中開啟

### 故事 2: 開發者檢出現有分支進行測試
**身份**: QA 工程師
**需求**: 我需要測試一個現有的功能分支，但不想切換當前工作分支
**行為**:
1. 執行 `wt add`
2. 選擇 "現有分支" 選項
3. 從列表中選擇 "feature-payment"
4. 選擇不在 VSCode 中開啟
**結果**: 系統創建對應的 worktree 目錄，檢出現有分支供測試

### 故事 3: 開發者清理不需要的 worktree
**身份**: 軟體開發者
**需求**: 功能開發完成後，我想清理不再需要的 worktree 目錄
**行為**:
1. 執行 `wt remove`
2. 從列表中選擇要移除的 worktree
3. 確認刪除操作
**結果**: 系統安全移除選擇的 worktree 及其目錄

### 故事 4: 開發者快速切換到其他 worktree
**身份**: 軟體開發者
**需求**: 我想快速在不同的功能分支間切換工作
**行為**:
1. 執行 `wt open`
2. 從列表中選擇目標 worktree
**結果**: VSCode 開啟選擇的 worktree 目錄

### 故事 5: 新使用者安裝工具
**身份**: 新的團隊成員
**需求**: 我需要安裝這個工具來管理 Git worktree
**行為**:
1. 執行安裝腳本或下載二進制檔案
2. 將工具加入 PATH
3. 執行 `wt --help` 驗證安裝
**結果**: 工具成功安裝並可正常使用，無需安裝 Rust 工具鏈

## 非功能需求

### 可用性
- **學習曲線**: 與現有 TypeScript 版本完全相同的使用體驗
- **錯誤訊息**: 清晰、可操作的錯誤訊息
- **文檔**: 完整的使用說明和範例

### 可靠性
- **錯誤處理**: 優雅處理 Git 命令失敗、權限錯誤等異常情況
- **資料完整性**: 確保 Git 倉庫狀態不被破壞
- **回滾機制**: 操作失敗時的清理和回滾

### 可維護性
- **程式碼結構**: 清晰的模組化架構
- **測試覆蓋**: 單元測試和整合測試
- **版本管理**: 語義化版本控制

### 安全性
- **輸入驗證**: 防止命令注入和路徑遍歷
- **權限檢查**: 適當的檔案系統權限驗證
- **依賴安全**: 使用安全、維護良好的第三方套件

---
**狀態**: 需求已生成，等待審核
**下一步**: 審核需求並更新 spec.json 為已生成狀態
